<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clash Royale Analytics Tracker</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary: #ff7b00;
            --secondary: #1a1a2e;
            --accent: #ffbb00;
            --light: #f8f9fa;
            --dark: #16213e;
            --success: #28a745;
            --danger: #dc3545;
            --warning: #ffc107;
            --info: #17a2b8;
        }

        body {
            background: linear-gradient(135deg, var(--secondary), var(--dark));
            color: var(--light);
            min-height: 100vh;
            padding-bottom: 2rem;
        }

        header {
            background: rgba(0, 0, 0, 0.7);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo i {
            font-size: 2.5rem;
            color: var(--primary);
        }

        .logo h1 {
            font-size: 1.8rem;
            background: linear-gradient(to right, var(--primary), var(--accent));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .search-container {
            display: flex;
            gap: 0.5rem;
        }

        .search-container input {
            padding: 0.7rem 1rem;
            border: none;
            border-radius: 50px;
            width: 300px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 1rem;
        }

        .search-container input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .search-container button {
            padding: 0.7rem 1.5rem;
            border: none;
            border-radius: 50px;
            background: var(--primary);
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .search-container button:hover {
            background: var(--accent);
            transform: translateY(-2px);
        }

        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1.5rem;
        }

        .dashboard {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 2rem;
        }

        .player-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
        }

        .player-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .player-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(45deg, var(--primary), var(--accent));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: white;
        }

        .player-info h2 {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }

        .player-info p {
            color: rgba(255, 255, 255, 0.7);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .stat-card {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 1rem;
            text-align: center;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .stat-label {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.7);
        }

        .deck-section {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
        }

        .section-title {
            font-size: 1.5rem;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .section-title i {
            color: var(--primary);
        }

        .deck-cards {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
        }

        .card {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 1rem;
            text-align: center;
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card-icon {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            color: var(--accent);
        }

        .card-name {
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .card-level {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
        }

        .analytics-section {
            grid-column: 1 / -1;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
            margin-top: 2rem;
        }

        .charts-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 2rem;
            margin-top: 1.5rem;
        }

        .chart {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 1.5rem;
            height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .chart-placeholder {
            text-align: center;
            color: rgba(255, 255, 255, 0.7);
        }

        .chart-placeholder i {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: var(--primary);
        }

        .recent-battles {
            margin-top: 2rem;
        }

        .battle-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .battle-card {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .battle-result {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .battle-result.win .result-badge {
            background: var(--success);
        }

        .battle-result.loss .result-badge {
            background: var(--danger);
        }

        .result-badge {
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.8rem;
        }

        .battle-info {
            display: flex;
            gap: 2rem;
        }

        .battle-mode, .battle-trophies {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .battle-mode i, .battle-trophies i {
            font-size: 1.2rem;
            margin-bottom: 0.3rem;
            color: var(--primary);
        }

        .battle-mode span, .battle-trophies span {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.7);
        }

        footer {
            text-align: center;
            margin-top: 3rem;
            padding: 1.5rem;
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.9rem;
        }

        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 200px;
            font-size: 1.2rem;
        }

        .loading i {
            margin-right: 0.5rem;
            color: var(--primary);
        }

        .error-message {
            background: rgba(220, 53, 69, 0.2);
            color: #ff6b6b;
            padding: 1rem;
            border-radius: 10px;
            text-align: center;
            margin: 1rem 0;
            border: 1px solid rgba(220, 53, 69, 0.5);
        }

        .success-message {
            background: rgba(40, 167, 69, 0.2);
            color: #6bff8d;
            padding: 1rem;
            border-radius: 10px;
            text-align: center;
            margin: 1rem 0;
            border: 1px solid rgba(40, 167, 69, 0.5);
        }

        @media (max-width: 992px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            .deck-cards {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .charts-container {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            header {
                flex-direction: column;
                gap: 1rem;
                padding: 1rem;
            }
            
            .search-container input {
                width: 200px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="logo">
            <i class="fas fa-crown"></i>
            <h1>Clash Royale Analytics</h1>
        </div>
        <div class="search-container">
            <input type="text" id="playerTag" placeholder="Enter Player Tag (e.g. #U8028CG2V)" value="#U8028CG2V">
            <button id="searchBtn">Search</button>
        </div>
    </header>

    <div class="container">
        <div id="errorContainer"></div>
        <div id="successContainer"></div>
        
        <div class="dashboard" id="dashboard">
            <!-- Content will be loaded here -->
        </div>
    </div>

    <footer>
        <p>Clash Royale Analytics Tracker &copy; 2023 | This is a fan-made site and is not affiliated with Supercell.</p>
        <p>Data provided by the Clash Royale API</p>
    </footer>

    <script>
        // API Configuration with your real token
        const API_BASE_URL = 'https://api.clashroyale.com/v1';
        const API_TOKEN = 'eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzUxMiIsImtpZCI6IjI4YTMxOGY3LTAwMDAtYTFlYi03ZmExLTJjNzQzM2M2Y2NhNSJ9.eyJpc3MiOiJzdXBlcmNlbGwiLCJhdWQiOiJzdXBlcmNlbGw6Z2FtZWFwaSIsImp0aSI6IjgxYTg0ODU1LWYwZWMtNGJhOC05N2Q5LWMwZGE5NWMzMDg0OCIsImlhdCI6MTc1OTk0NjIzNSwic3ViIjoiZGV2ZWxvcGVyLzBmZmI5NjRkLTRiZmItYTZkZi1hZDRhLTk4Njc5Mjk5YzNlNiIsInNjb3BlcyI6WyJyb3lhbGUiXSwibGltaXRzIjpbeyJ0aWVyIjoiZGV2ZWxvcGVyL3NpbHZlciIsInR5cGUiOiJ0aHJvdHRsaW5nIn0seyJjaWRycyI6WyI2Ni4yNDQuMjM0LjI1NCJdLCJ0eXBlIjoiY2xpZW50In1dfQ.Io8vuL-IQ2FsOPKISWb0AfXZuT811yNG3_TN6gMs1vPQ6NhAyWG_1UU9ptIJxwYlXQvPtWokalPIsp2tk2D8Dg';

        // DOM Elements
        const playerTagInput = document.getElementById('playerTag');
        const searchBtn = document.getElementById('searchBtn');
        const errorContainer = document.getElementById('errorContainer');
        const successContainer = document.getElementById('successContainer');
        const dashboard = document.getElementById('dashboard');

        // Show initial state
        function showInitialState() {
            dashboard.innerHTML = `
                <div class="player-card">
                    <div class="player-header">
                        <div class="player-avatar">
                            <i class="fas fa-user"></i>
                        </div>
                        <div class="player-info">
                            <h2>Enter Player Tag</h2>
                            <p>Search for a player to see their stats</p>
                        </div>
                    </div>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value">-</div>
                            <div class="stat-label">Trophies</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">-</div>
                            <div class="stat-label">King Level</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">-</div>
                            <div class="stat-label">Total Wins</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">-</div>
                            <div class="stat-label">Total Losses</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">-</div>
                            <div class="stat-label">Win Rate</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">-</div>
                            <div class="stat-label">Best Trophies</div>
                        </div>
                    </div>
                </div>

                <div class="deck-section">
                    <h2 class="section-title"><i class="fas fa-layer-group"></i> Current Deck</h2>
                    <div class="deck-cards">
                        ${Array(8).fill(0).map(() => `
                            <div class="card">
                                <div class="card-icon">
                                    <i class="fas fa-shield-alt"></i>
                                </div>
                                <div class="card-name">Search Player</div>
                                <div class="card-level">Level -</div>
                            </div>
                        `).join('')}
                    </div>
                </div>

                <div class="analytics-section">
                    <h2 class="section-title"><i class="fas fa-chart-line"></i> Analytics</h2>
                    <div class="charts-container">
                        <div class="chart">
                            <div class="chart-placeholder">
                                <i class="fas fa-trophy"></i>
                                <h3>Trophy Progress</h3>
                                <p>Chart showing trophy progression over time</p>
                            </div>
                        </div>
                        <div class="chart">
                            <div class="chart-placeholder">
                                <i class="fas fa-chart-pie"></i>
                                <h3>Deck Win Rate</h3>
                                <p>Win rate analysis for current deck</p>
                            </div>
                        </div>
                    </div>

                    <div class="recent-battles">
                        <h2 class="section-title"><i class="fas fa-history"></i> Recent Battles</h2>
                        <div class="battle-list">
                            <div class="battle-card">
                                <div class="battle-result">
                                    <div>Search for a player to see battle history</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Show loading state
        function showLoading() {
            dashboard.innerHTML = `
                <div class="loading">
                    <i class="fas fa-spinner fa-spin"></i>
                    Loading player data from Clash Royale API...
                </div>
            `;
        }

        // Show error message
        function showError(message) {
            errorContainer.innerHTML = `
                <div class="error-message">
                    <i class="fas fa-exclamation-triangle"></i>
                    ${message}
                </div>
            `;
            successContainer.innerHTML = '';
        }

        // Show success message
        function showSuccess(message) {
            successContainer.innerHTML = `
                <div class="success-message">
                    <i class="fas fa-check-circle"></i>
                    ${message}
                </div>
            `;
            errorContainer.innerHTML = '';
        }

        // Clear messages
        function clearMessages() {
            errorContainer.innerHTML = '';
            successContainer.innerHTML = '';
        }

        // Fetch player data from Clash Royale API
        async function fetchPlayerData(playerTag) {
            try {
                clearMessages();
                showLoading();

                // Remove # and encode for URL
                const cleanTag = playerTag.replace('#', '').toUpperCase();
                const encodedTag = encodeURIComponent(cleanTag);
                
                console.log('Fetching data for player tag:', cleanTag);

                const response = await fetch(`${API_BASE_URL}/players/${encodedTag}`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${API_TOKEN}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) {
                    if (response.status === 404) {
                        throw new Error('Player not found. Please check the player tag.');
                    } else if (response.status === 403) {
                        throw new Error('Invalid API token or access denied.');
                    } else if (response.status === 429) {
                        throw new Error('Rate limit exceeded. Please try again later.');
                    } else {
                        throw new Error(`API error: ${response.status} ${response.statusText}`);
                    }
                }

                const playerData = await response.json();
                return playerData;

            } catch (error) {
                console.error('Error fetching player data:', error);
                throw error;
            }
        }

        // Fetch battle log
        async function fetchBattleLog(playerTag) {
            try {
                const cleanTag = playerTag.replace('#', '').toUpperCase();
                const encodedTag = encodeURIComponent(cleanTag);

                const response = await fetch(`${API_BASE_URL}/players/${encodedTag}/battlelog`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${API_TOKEN}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) {
                    throw new Error(`Battle log error: ${response.status}`);
                }

                return await response.json();

            } catch (error) {
                console.error('Error fetching battle log:', error);
                return [];
            }
        }

        // Update UI with player data
        function updatePlayerUI(playerData, battleLog) {
            // Calculate win rate
            const wins = playerData.wins || 0;
            const losses = playerData.losses || 0;
            const totalGames = wins + losses;
            const winRate = totalGames > 0 ? ((wins / totalGames) * 100).toFixed(1) : 0;

            dashboard.innerHTML = `
                <div class="player-card">
                    <div class="player-header">
                        <div class="player-avatar">
                            <i class="fas fa-user"></i>
                        </div>
                        <div class="player-info">
                            <h2>${playerData.name}</h2>
                            <p>Tag: #${playerData.tag}</p>
                            ${playerData.clan ? `<p>Clan: ${playerData.clan.name}</p>` : ''}
                        </div>
                    </div>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value">${playerData.trophies}</div>
                            <div class="stat-label">Trophies</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${playerData.expLevel}</div>
                            <div class="stat-label">King Level</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${wins}</div>
                            <div class="stat-label">Total Wins</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${losses}</div>
                            <div class="stat-label">Total Losses</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${winRate}%</div>
                            <div class="stat-label">Win Rate</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${playerData.bestTrophies}</div>
                            <div class="stat-label">Best Trophies</div>
                        </div>
                    </div>
                </div>

                <div class="deck-section">
                    <h2 class="section-title"><i class="fas fa-layer-group"></i> Current Deck</h2>
                    <div class="deck-cards">
                        ${playerData.currentDeck ? playerData.currentDeck.map(card => `
                            <div class="card">
                                <div class="card-icon">
                                    <i class="fas fa-shield-alt"></i>
                                </div>
                                <div class="card-name">${card.name}</div>
                                <div class="card-level">Level ${card.level}</div>
                            </div>
                        `).join('') : 'No deck data available'}
                    </div>
                </div>

                <div class="analytics-section">
                    <h2 class="section-title"><i class="fas fa-chart-line"></i> Analytics</h2>
                    <div class="charts-container">
                        <div class="chart">
                            <div class="chart-placeholder">
                                <i class="fas fa-trophy"></i>
                                <h3>Trophy Progress</h3>
                                <p>Chart showing trophy progression over time</p>
                            </div>
                        </div>
                        <div class="chart">
                            <div class="chart-placeholder">
                                <i class="fas fa-chart-pie"></i>
                                <h3>Deck Win Rate</h3>
                                <p>Win rate analysis for current deck</p>
                            </div>
                        </div>
                    </div>

                    <div class="recent-battles">
                        <h2 class="section-title"><i class="fas fa-history"></i> Recent Battles</h2>
                        <div class="battle-list">
                            ${battleLog && battleLog.length > 0 ? battleLog.slice(0, 5).map(battle => {
                                const teamCrowns = battle.team[0]?.crowns || 0;
                                const opponentCrowns = battle.opponent[0]?.crowns || 0;
                                const isWin = teamCrowns > opponentCrowns;
                                const gameMode = battle.gameMode?.name || 'Unknown';
                                
                                return `
                                    <div class="battle-card">
                                        <div class="battle-result ${isWin ? 'win' : 'loss'}">
                                            <div class="result-badge">${isWin ? 'WIN' : 'LOSS'}</div>
                                            <div>${formatBattleTime(battle.battleTime)}</div>
                                        </div>
                                        <div class="battle-info">
                                            <div class="battle-mode">
                                                <i class="fas fa-gamepad"></i>
                                                <span>${gameMode}</span>
                                            </div>
                                            <div class="battle-trophies">
                                                <i class="fas fa-crown"></i>
                                                <span>${teamCrowns}-${opponentCrowns}</span>
                                            </div>
                                        </div>
                                    </div>
                                `;
                            }).join('') : '<div class="battle-card"><div>No recent battles found</div></div>'}
                        </div>
                    </div>
                </div>
            `;
        }

        // Format battle time
        function formatBattleTime(battleTime) {
            try {
                const date = new Date(battleTime);
                const now = new Date();
                const diffMs = now - date;
                const diffHours = Math.floor(diffMs / (1000 * 60 * 60));
                const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
                
                if (diffHours < 1) return 'Just now';
                if (diffHours < 24) return `${diffHours}h ago`;
                if (diffDays === 1) return '1 day ago';
                return `${diffDays} days ago`;
            } catch {
                return 'Recent';
            }
        }

        // Main search function
        async function searchPlayer() {
            const playerTag = playerTagInput.value.trim();
            
            if (!playerTag) {
                showError('Please enter a player tag');
                return;
            }

            if (!playerTag.startsWith('#')) {
                showError('Player tag must start with #');
                return;
            }

            try {
                const [playerData, battleLog] = await Promise.all([
                    fetchPlayerData(playerTag),
                    fetchBattleLog(playerTag)
                ]);

                updatePlayerUI(playerData, battleLog);
                showSuccess(`Successfully loaded data for ${playerData.name}!`);

            } catch (error) {
                showError(error.message);
                showInitialState();
            }
        }

        // Event listeners
        searchBtn.addEventListener('click', searchPlayer);

        playerTagInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                searchPlayer();
            }
        });

        // Initialize
        showInitialState();
        console.log('Clash Royale Analytics Tracker initialized with real API token');
    </script>
</body>
</html>
