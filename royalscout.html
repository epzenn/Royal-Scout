<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Clash Royale Tracker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            color: white;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 123, 0, 0.1);
            border-radius: 10px;
        }
        
        h1 {
            color: #ff7b00;
            margin-bottom: 10px;
        }
        
        .search-box {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin: 20px 0;
        }
        
        input {
            padding: 12px;
            border: none;
            border-radius: 5px;
            width: 300px;
            font-size: 16px;
        }
        
        button {
            padding: 12px 24px;
            background: #ff7b00;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
        }
        
        button:hover {
            background: #ff9500;
        }
        
        button:disabled {
            background: #666;
            cursor: not-allowed;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            font-size: 18px;
        }
        
        .player-info {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #ff7b00;
        }
        
        .stat-label {
            font-size: 14px;
            color: #ccc;
        }
        
        .deck-section {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .deck-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .card {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        
        .card-icon {
            font-size: 40px;
            margin-bottom: 10px;
            color: #ffbb00;
        }
        
        .battles-section {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
        }
        
        .battle {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .win {
            border-left: 4px solid #28a745;
        }
        
        .loss {
            border-left: 4px solid #dc3545;
        }
        
        .error {
            background: rgba(220, 53, 69, 0.2);
            color: #ff6b6b;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            margin: 20px 0;
        }
        
        .success {
            background: rgba(40, 167, 69, 0.2);
            color: #6bff8d;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            margin: 20px 0;
        }
        
        .hidden {
            display: none;
        }
        
        .api-status {
            margin-top: 10px;
            font-size: 14px;
            color: #ccc;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Clash Royale Analytics Tracker</h1>
            <p>Enter your player tag to view stats and analytics</p>
            
            <div class="search-box">
                <input type="text" id="playerTag" placeholder="Enter Player Tag (e.g. #U8028CG2V)" value="#U8028CG2V">
                <button id="searchBtn">Search Player</button>
            </div>
            <div class="api-status" id="apiStatus">Using demo data - API access required for real data</div>
        </header>

        <div id="loading" class="loading hidden">
            <p>Loading player data...</p>
        </div>

        <div id="error" class="error hidden"></div>
        <div id="success" class="success hidden"></div>

        <div id="playerData" class="hidden">
            <div class="player-info">
                <h2 id="playerName">Player Name</h2>
                <p id="playerTagDisplay">Tag: #U8028CG2V</p>
                <p id="playerClan">Clan: Loading...</p>
                <p id="dataSource" style="color: #ff7b00; font-size: 14px; margin-top: 10px;"></p>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="trophies">0</div>
                    <div class="stat-label">Trophies</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="level">0</div>
                    <div class="stat-label">King Level</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="wins">0</div>
                    <div class="stat-label">Total Wins</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="losses">0</div>
                    <div class="stat-label">Total Losses</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="winRate">0%</div>
                    <div class="stat-label">Win Rate</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="bestTrophies">0</div>
                    <div class="stat-label">Best Trophies</div>
                </div>
            </div>

            <div class="deck-section">
                <h3>Current Deck</h3>
                <div class="deck-cards" id="deckContainer">
                    <!-- Cards will be loaded here -->
                </div>
            </div>

            <div class="battles-section">
                <h3>Recent Battles</h3>
                <div id="battleList">
                    <!-- Battles will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // API Configuration
        const API_BASE_URL = 'https://api.clashroyale.com/v1';
        
        // Your API token (replace with actual token from https://developer.clashroyale.com)
        const API_TOKEN = 'rncyr978';
        
        // Sample data for demonstration
        const SAMPLE_PLAYER_DATA = {
            name: "ClashMaster",
            tag: "#U8028CG2V",
            trophies: 5432,
            level: 13,
            wins: 1247,
            losses: 892,
            bestTrophies: 5678,
            clan: "Royale Warriors",
            deck: [
                { name: "Knight", level: 12, elixir: 3 },
                { name: "Archers", level: 13, elixir: 3 },
                { name: "Fireball", level: 11, elixir: 4 },
                { name: "Mega Minion", level: 12, elixir: 3 },
                { name: "Battle Ram", level: 12, elixir: 4 },
                { name: "Poison", level: 10, elixir: 4 },
                { name: "Electro Wizard", level: 11, elixir: 4 },
                { name: "P.E.K.K.A", level: 9, elixir: 7 }
            ],
            battles: [
                { result: "win", mode: "Ladder", teamCrowns: 3, opponentCrowns: 1, timestamp: "2 hours ago" },
                { result: "loss", mode: "2v2", teamCrowns: 0, opponentCrowns: 2, timestamp: "5 hours ago" },
                { result: "win", mode: "Challenge", teamCrowns: 2, opponentCrowns: 0, timestamp: "1 day ago" },
                { result: "win", mode: "Ladder", teamCrowns: 1, opponentCrowns: 0, timestamp: "1 day ago" },
                { result: "loss", mode: "Ladder", teamCrowns: 1, opponentCrowns: 3, timestamp: "2 days ago" }
            ]
        };

        // DOM Elements
        const playerTagInput = document.getElementById('playerTag');
        const searchBtn = document.getElementById('searchBtn');
        const loadingDiv = document.getElementById('loading');
        const errorDiv = document.getElementById('error');
        const successDiv = document.getElementById('success');
        const playerDataDiv = document.getElementById('playerData');
        const apiStatusDiv = document.getElementById('apiStatus');
        const dataSourceDiv = document.getElementById('dataSource');

        // Show/hide functions
        function showLoading() {
            loadingDiv.classList.remove('hidden');
            playerDataDiv.classList.add('hidden');
            errorDiv.classList.add('hidden');
            successDiv.classList.add('hidden');
            searchBtn.disabled = true;
        }

        function hideLoading() {
            loadingDiv.classList.add('hidden');
            searchBtn.disabled = false;
        }

        function showError(message) {
            errorDiv.textContent = message;
            errorDiv.classList.remove('hidden');
            playerDataDiv.classList.add('hidden');
            successDiv.classList.add('hidden');
        }

        function showSuccess(message) {
            successDiv.textContent = message;
            successDiv.classList.remove('hidden');
            errorDiv.classList.add('hidden');
        }

        function showPlayerData(source = "demo") {
            playerDataDiv.classList.remove('hidden');
            errorDiv.classList.add('hidden');
            dataSourceDiv.textContent = `Data source: ${source}`;
        }

        // Real API Functions
        async function fetchRealPlayerData(playerTag) {
            try {
                const cleanTag = playerTag.replace('#', '').toUpperCase();
                const encodedTag = encodeURIComponent(cleanTag);
                
                console.log('Fetching real API data for tag:', cleanTag);
                
                const response = await fetch(`${API_BASE_URL}/players/${encodedTag}`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${API_TOKEN}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) {
                    throw new Error(`API returned ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                return data;
                
            } catch (error) {
                console.error('Real API Error:', error);
                throw error;
            }
        }

        async function fetchRealBattleLog(playerTag) {
            try {
                const cleanTag = playerTag.replace('#', '').toUpperCase();
                const encodedTag = encodeURIComponent(cleanTag);
                
                const response = await fetch(`${API_BASE_URL}/players/${encodedTag}/battlelog`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${API_TOKEN}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) {
                    throw new Error(`Battle log error: ${response.status}`);
                }

                return await response.json();
                
            } catch (error) {
                console.error('Battle log error:', error);
                return [];
            }
        }

        // Demo Data Functions
        function getDemoPlayerData(playerTag) {
            // Create variation based on player tag for demo purposes
            const demoData = {...SAMPLE_PLAYER_DATA};
            demoData.tag = playerTag;
            
            // Add some random variation to make it look different
            const hash = playerTag.split('').reduce((a, b) => a + b.charCodeAt(0), 0);
            demoData.trophies = 5000 + (hash % 2000);
            demoData.wins = 1000 + (hash % 500);
            demoData.losses = 800 + (hash % 400);
            demoData.bestTrophies = demoData.trophies + 200 + (hash % 100);
            demoData.level = 11 + (hash % 4);
            
            return demoData;
        }

        // Data Processing
        function processPlayerData(apiData, battleLog, source) {
            const wins = apiData.wins || 0;
            const losses = apiData.losses || 0;
            const totalGames = wins + losses;
            const winRate = totalGames > 0 ? ((wins / totalGames) * 100).toFixed(1) : 0;

            return {
                name: apiData.name,
                tag: apiData.tag,
                trophies: apiData.trophies,
                level: apiData.expLevel || apiData.level,
                wins: wins,
                losses: losses,
                winRate: winRate,
                bestTrophies: apiData.bestTrophies,
                clan: apiData.clan ? (apiData.clan.name || apiData.clan) : 'No Clan',
                deck: apiData.currentDeck || apiData.deck || [],
                battles: battleLog || apiData.battles || [],
                source: source
            };
        }

        // UI Update Functions
        function updatePlayerUI(playerData) {
            // Basic info
            document.getElementById('playerName').textContent = playerData.name;
            document.getElementById('playerTagDisplay').textContent = `Tag: ${playerData.tag}`;
            document.getElementById('playerClan').textContent = `Clan: ${playerData.clan}`;
            
            // Stats
            document.getElementById('trophies').textContent = playerData.trophies;
            document.getElementById('level').textContent = playerData.level;
            document.getElementById('wins').textContent = playerData.wins;
            document.getElementById('losses').textContent = playerData.losses;
            document.getElementById('winRate').textContent = `${playerData.winRate}%`;
            document.getElementById('bestTrophies').textContent = playerData.bestTrophies;
            
            // Deck
            updateDeckUI(playerData.deck);
            
            // Battles
            updateBattlesUI(playerData.battles);
            
            showPlayerData(playerData.source);
            
            if (playerData.source === "real") {
                showSuccess("Successfully loaded real player data from Clash Royale API!");
            } else {
                showSuccess("Showing demo data. To see real data, please set up a valid API token.");
            }
        }

        function updateDeckUI(deck) {
            const deckContainer = document.getElementById('deckContainer');
            deckContainer.innerHTML = '';

            if (deck.length === 0) {
                deckContainer.innerHTML = '<p>No deck data available</p>';
                return;
            }

            deck.forEach(card => {
                const cardEl = document.createElement('div');
                cardEl.className = 'card';
                cardEl.innerHTML = `
                    <div class="card-icon">⚔️</div>
                    <div class="card-name">${card.name}</div>
                    <div class="card-level">Level ${card.level}</div>
                    <div class="card-elixir">${card.elixir} Elixir</div>
                `;
                deckContainer.appendChild(cardEl);
            });
        }

        function updateBattlesUI(battles) {
            const battleList = document.getElementById('battleList');
            battleList.innerHTML = '';

            if (battles.length === 0) {
                battleList.innerHTML = '<p>No recent battles found</p>';
                return;
            }

            battles.forEach(battle => {
                const battleEl = document.createElement('div');
                battleEl.className = `battle ${battle.result}`;
                battleEl.innerHTML = `
                    <div>
                        <strong>${battle.mode}</strong>
                        <div>${battle.timestamp}</div>
                    </div>
                    <div>
                        <strong>${battle.teamCrowns} - ${battle.opponentCrowns}</strong>
                        <div style="color: ${battle.result === 'win' ? '#28a745' : '#dc3545'}">
                            ${battle.result.toUpperCase()}
                        </div>
                    </div>
                `;
                battleList.appendChild(battleEl);
            });
        }

        // Main Search Function
        async function searchPlayer() {
            const playerTag = playerTagInput.value.trim();
            
            if (!playerTag) {
                showError('Please enter a player tag');
                return;
            }

            // Validate player tag format
            if (!playerTag.startsWith('#')) {
                showError('Player tag must start with #');
                return;
            }

            showLoading();

            try {
                let playerData, battleLog, source;
                
                // Try real API first
                try {
                    console.log('Attempting to fetch from real API...');
                    playerData = await fetchRealPlayerData(playerTag);
                    battleLog = await fetchRealBattleLog(playerTag);
                    source = "real";
                    apiStatusDiv.textContent = "Connected to Clash Royale API";
                    apiStatusDiv.style.color = "#28a745";
                } catch (apiError) {
                    console.log('Real API failed, using demo data:', apiError.message);
                    // Fall back to demo data
                    playerData = getDemoPlayerData(playerTag);
                    battleLog = [];
                    source = "demo";
                    apiStatusDiv.textContent = "Using demo data - API unavailable";
                    apiStatusDiv.style.color = "#ff7b00";
                }
                
                const processedData = processPlayerData(playerData, battleLog, source);
                updatePlayerUI(processedData);
                
            } catch (error) {
                console.error('Search error:', error);
                showError('Failed to load player data: ' + error.message);
            } finally {
                hideLoading();
            }
        }

        // Event Listeners
        searchBtn.addEventListener('click', searchPlayer);

        playerTagInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                searchPlayer();
            }
        });

        // Initialize
        console.log('Clash Royale Tracker Ready!');
        console.log('Player tag to try: #U8028CG2V');
        
        // Auto-load demo data on startup
        setTimeout(() => {
            const demoData = getDemoPlayerData("#U8028CG2V");
            updatePlayerUI(processPlayerData(demoData, demoData.battles, "demo"));
        }, 500);
    </script>
</body>
</html>
